name: Test Notification

on:
  workflow_dispatch:
    inputs:
      message:
        description: "Test message content"
        required: true
        type: string
        default: "Hello from haginotifier!"
      msg_type:
        description: "Message type (text, post, or interactive)"
        required: false
        type: choice
        options:
          - text
          - post
          - interactive
        default: text
      title:
        description: "Message title (for post/interactive)"
        required: false
        type: string

permissions:
  contents: read

jobs:
  test-notify:
    name: Test Notification
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - id: notification
        uses: ./ # Uses action.yml from the current repository
        with:
          message: ${{ inputs.message }}
          msg_type: ${{ inputs.msg_type }}
          title: ${{ inputs.title }}
        env:
          FEISHU_WEBHOOK_URL: ${{ secrets.FEISHU_WEBHOOK_URL }}

      - name: Display notification result
        if: always()
        run: |
          echo "### Notification Result" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "- **Status**: ${{ steps.notification.outputs.status }}" >> $GITHUB_STEP_SUMMARY
          echo "- **Timestamp**: ${{ steps.notification.outputs.timestamp }}" >> $GITHUB_STEP_SUMMARY
          echo "- **Response**: ${{ steps.notification.outputs.response }}" >> $GITHUB_STEP_SUMMARY
